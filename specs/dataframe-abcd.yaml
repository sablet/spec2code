version: "1"
meta:
  name: "dataframe-abcd"
  description: "DataFrame pipeline with a->b, b+c->d DAG structure"

checks:
  - id: check_a
    description: "DataFrame A validation"
    impl: "apps.dataframe-abcd.checks.dataframe_checks:check_a"
    file_path: "checks/dataframe_checks.py"

  - id: check_b
    description: "DataFrame B validation"
    impl: "apps.dataframe-abcd.checks.dataframe_checks:check_b"
    file_path: "checks/dataframe_checks.py"

  - id: check_c
    description: "DataFrame C validation"
    impl: "apps.dataframe-abcd.checks.dataframe_checks:check_c"
    file_path: "checks/dataframe_checks.py"

  - id: check_d
    description: "DataFrame D validation"
    impl: "apps.dataframe-abcd.checks.dataframe_checks:check_d"
    file_path: "checks/dataframe_checks.py"

examples:
  - id: ex_a
    description: "DataFrame A example data"
    input:
      rows:
        - id: 1
          value: 100
        - id: 2
          value: 200
    expected:
      row_count: 2

  - id: ex_b
    description: "DataFrame B example data"
    input:
      rows:
        - id: 1
          value: 100
          processed: 110
        - id: 2
          value: 200
          processed: 220
    expected:
      row_count: 2

  - id: ex_c
    description: "DataFrame C example data"
    input:
      rows:
        - id: 1
          factor: 1.5
        - id: 2
          factor: 2.0
    expected:
      row_count: 2

  - id: ex_d
    description: "DataFrame D example data"
    input:
      rows:
        - id: 1
          value: 100
          processed: 110
          factor: 1.5
          result: 165
        - id: 2
          value: 200
          processed: 220
          factor: 2.0
          result: 440
    expected:
      row_count: 2

datatypes:
  - id: DataFrameA
    description: "DataFrame A (raw input data)"
    check_ids:
      - check_a
    example_ids:
      - ex_a
    schema:
      type: object
      properties:
        id:
          type: integer
        value:
          type: number
      required:
        - id
        - value

  - id: DataFrameB
    description: "DataFrame B (processed data from A)"
    check_ids:
      - check_b
    example_ids:
      - ex_b
    schema:
      type: object
      properties:
        id:
          type: integer
        value:
          type: number
        processed:
          type: number
      required:
        - id
        - value
        - processed

  - id: DataFrameC
    description: "DataFrame C (factor data)"
    check_ids:
      - check_c
    example_ids:
      - ex_c
    schema:
      type: object
      properties:
        id:
          type: integer
        factor:
          type: number
      required:
        - id
        - factor

  - id: DataFrameD
    description: "DataFrame D (final result combining B and C)"
    check_ids:
      - check_d
    example_ids:
      - ex_d
    schema:
      type: object
      properties:
        id:
          type: integer
        value:
          type: number
        processed:
          type: number
        factor:
          type: number
        result:
          type: number
      required:
        - id
        - value
        - processed
        - factor
        - result

transforms:
  - id: transform_a_to_b
    description: "Transform from A to B (add processed column)"
    impl: "apps.dataframe-abcd.transforms.transform_a_to_b:transform_a_to_b"
    file_path: "transforms/transform_a_to_b.py"
    parameters:
      - name: data_a
        datatype_ref: DataFrameA
        native: "pandas:DataFrame"
    return_datatype_ref: DataFrameB
    return_native: "pandas:DataFrame"

  - id: transform_bc_to_d
    description: "Transform from B and C to D (combine and calculate result)"
    impl: "apps.dataframe-abcd.transforms.transform_bc_to_d:transform_bc_to_d"
    file_path: "transforms/transform_bc_to_d.py"
    parameters:
      - name: data_b
        datatype_ref: DataFrameB
        native: "pandas:DataFrame"
      - name: data_c
        datatype_ref: DataFrameC
        native: "pandas:DataFrame"
    return_datatype_ref: DataFrameD
    return_native: "pandas:DataFrame"

dag:
  - from: transform_a_to_b
    to: transform_bc_to_d
  - from: transform_bc_to_d
    to: null
